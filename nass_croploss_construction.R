
usda000 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1988.txt", sep="")
usda000 <- read.csv(usda000, header=FALSE, sep="|")
usda000 <- data.frame(usda000)


usda0 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2000.txt", sep="")
usda0 <- read.csv(usda0, header=FALSE, sep="|")
usda0 <- data.frame(usda0)

usda89 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1989.txt", sep="")
usda89 <- read.csv(usda89, header=FALSE, sep="|")
usda89 <- data.frame(usda89)

usda90 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1990.txt", sep="")
usda90 <- read.csv(usda90, header=FALSE, sep="|")
usda90 <- data.frame(usda90)

usda91 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1991.txt", sep="")
usda91 <- read.csv(usda91, header=FALSE, sep="|")
usda91 <- data.frame(usda91)

usda92 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1992.txt", sep="")
usda92 <- read.csv(usda92, header=FALSE, sep="|")
usda92 <- data.frame(usda92)

usda93 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1993.txt", sep="")
usda93 <- read.csv(usda93, header=FALSE, sep="|")
usda93 <- data.frame(usda93)

usda94 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1994.txt", sep="")
usda94 <- read.csv(usda94, header=FALSE, sep="|")
usda94 <- data.frame(usda94)


usda95 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1995.txt", sep="")
usda95 <- read.csv(usda95, header=FALSE, sep="|")
usda95 <- data.frame(usda95)

usda96 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1996.txt", sep="")
usda96 <- read.csv(usda96, header=FALSE, sep="|")
usda96 <- data.frame(usda96)

usda97 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1997.txt", sep="")
usda97 <- read.csv(usda97, header=FALSE, sep="|")
usda97 <- data.frame(usda97)

usda98 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1998.txt", sep="")
usda98 <- read.csv(usda98, header=FALSE, sep="|")
usda98 <- data.frame(usda98)

usda99 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "1999.txt", sep="")
usda99 <- read.csv(usda99, header=FALSE, sep="|")
usda99 <- data.frame(usda99)

usda0 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2000.txt", sep="")
usda0 <- read.csv(usda0, header=FALSE, sep="|")
usda0 <- data.frame(usda0)







usda1 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2001.txt", sep="")
usda1 <- read.csv(usda1, header=FALSE, sep="|")
usda1 <- data.frame(usda1)
usda2 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2002.txt", sep="")
usda2 <- read.csv(usda2, header=FALSE, sep="|")
usda2 <- data.frame(usda2)
usda3 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2003.txt", sep="")
usda3 <- read.csv(usda3, header=FALSE, sep="|")
usda3 <- data.frame(usda3)
usda4 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2004.txt", sep="")
usda4 <- read.csv(usda4, header=FALSE, sep="|")
usda4 <- data.frame(usda4)
usda5 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2005.txt", sep="")
usda5 <- read.csv(usda5, header=FALSE, sep="|")
usda5 <- data.frame(usda5)
usda6 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2006.txt", sep="")
usda6 <- read.csv(usda6, header=FALSE, sep="|")
usda6 <- data.frame(usda6)
usda7 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2007.txt", sep="")
usda7 <- read.csv(usda7, header=FALSE, sep="|")
usda7 <- data.frame(usda7)
usda8 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2008.txt", sep="")
usda8 <- read.csv(usda8, header=FALSE, sep="|")
usda8 <- data.frame(usda8)
usda9 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2009.txt", sep="")
usda9 <- read.csv(usda9, header=FALSE, sep="|")
usda9 <- data.frame(usda9)
usda10 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2010.txt", sep="")
usda10 <- read.csv(usda10, header=FALSE, sep="|")
usda10 <- data.frame(usda10)
usda11 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2011.txt", sep="")
usda11 <- read.csv(usda11, header=FALSE, sep="|")
usda11 <- data.frame(usda11)
usda12 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2012.txt", sep="")
usda12 <- read.csv(usda12, header=FALSE, sep="|")
usda12 <- data.frame(usda12)
usda13 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2013.txt", sep="")
usda13 <- read.csv(usda13, header=FALSE, sep="|")
usda13 <- data.frame(usda13)
usda14 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2014.txt", sep="")
usda14 <- read.csv(usda14, header=FALSE, sep="|")
usda14 <- data.frame(usda14)
usda15 <- paste("/dmine/data/USDA/crop_indemnity_txt/", "2015.txt", sep="")
usda15 <- read.csv(usda15, header=FALSE, sep="|")
usda15 <- data.frame(usda15)

usdabound <- rbind(usda1,usda2,usda3,usda4,usda5,usda6,usda7,usda8,usda9,usda10,usda11,usda12,usda13,usda14,usda15)
usdabound2 <- rbind(usda89,usda90,usda91,usda92,usda93,usda94,usda95,usda96,usda97,usda98,usda99,usda0)

usdabound2a <- data.frame(append(usdabound2, list(acres=NA), after=match("V14", names(usdabound2)))) 
usdabound2b <- usdabound2a[,1:16]
colnames(usdabound2b) <- c("year", "statecode", "state", "countycode", "county", "commoditycode", "commodity", "insuranceplancode", "insurancename", "stagecode", "damagecausecode", "damagecause", "monthcode", "month", "acres", "loss")

colnames(usdabound2) <- c("year", "statecode", "state", "countycode", "county", "commoditycode", "commodity", "insuranceplancode", "insurancename", "stagecode", "damagecausecode", "damagecause", "monthcode", "month", "acres", "loss")
colnames(usdabound) <- c("year", "statecode", "state", "countycode", "county", "commoditycode", "commodity", "insuranceplancode", "insurancename", "stagecode", "damagecausecode", "damagecause", "monthcode", "month", "acres", "loss")

usdabound3 <- rbind(usdabound2b,usdabound)


usdabound3$county <- trimws(usdabound3$county)
usdabound3$commodity <- trimws(usdabound3$commodity)
usdabound3$damagecause <- trimws(usdabound3$damagecause)


usdabound$county <- trimws(usdabound$county)
usdabound$commodity <- trimws(usdabound$commodity)
usdabound$damagecause <- trimws(usdabound$damagecause)

usdabound <- usdabound3


#--loss


u1 <- subset(usdabound, damagecause != "")
u1 <- subset(u1, acres != 0)
u1 <- subset(u1, month != "")

u1a<- subset(u1, state == "OR")
u2<- subset(u1, state == "ID")
u3<- subset(u1, state == "WA")
u4 <- rbind(u1a, u2, u3)

u4a <- subset(u4, monthcode != 0)
u4a <- subset(u4a, county != "All Other Counties")


#---all of ID, OR, and WA

claimagg <- aggregate(loss ~ month + year + damagecause + county + state + commodity, u4a, sum)
#toBeRemoved<-which(claimagg$month == "   ")
#claimagg<-droplevels(claimagg[-toBeRemoved,])

claimaggmean <- aggregate(loss ~ month + year + damagecause + county + state + commodity, u4a, mean)
#toBeRemoved<-which(claimaggmean$month == "   ")
#claimaggmean<-droplevels(claimaggmean[-toBeRemoved,])

claimaggcount <- aggregate(loss ~ month + year + damagecause + county + state + commodity, u4a, length)
#toBeRemoved<-which(claimaggcount$month == "   ")
#claimaggcount<-droplevels(claimaggcount[-toBeRemoved,])

claimaggacres <- aggregate(acres ~ month + year + damagecause + county + state + commodity, u4a, sum)
#toBeRemoved<-which(claimaggacres$month == "   ")
#claimaggacres<-droplevels(claimaggacres[-toBeRemoved,])


colnames(claimaggcount)[7] <- "count"
colnames(claimaggmean)[7] <- "meanloss"
#--testing

#test1 <- subset(claimaggpalouse, commodity == "WHEAT")
#test2 <- subset(test1, county == "Whitman")
#test3 <- subset(test2, damagecause == "Drought")

#---only palouse

Idaho_list1 <- paste("Idaho", "Lewis", "Nez Perce", "Clearwater", "Latah", "Benewah", "Kootenai", "Okananogan", "Douglas", "Grant", "Benton", "Franklin", "Walla Walla", "Adams", "Lincoln", "Spokane", "Whitman", "Columbia", "Garfield", "Asotin", "Wasco", "Sherman", "Gilliam", "Morrow", "Umatilla", "Union", "Wallowa", sep="|")

claimaggpalouse <- subset(claimagg, county == "Idaho" | county == "Lewis" | county == "Nez Perce" | county == "Clearwater" | county == "Latah" | county == "Benewah" | county == "Kootenai" | county == "Okananogan" | county == "Douglas" | county == "Grant" | county == "Benton" | county == "Franklin" | county == "Walla Walla" | county == "Adams" | county == "Lincoln" | county == "Spokane" | county == "Whitman" | county == "Columbia" | county == "Garfield" | county == "Asotin" | county == "Wasco" | county == "Sherman" | county == "Gilliam" | county == "Morrow" | county == "Umatilla" | county == "Union" | county == "Wallowa")
claimaggmeanpalouse <- subset(claimaggmean, county == "Idaho" | county == "Lewis" | county == "Nez Perce" | county == "Clearwater" | county == "Latah" | county == "Benewah" | county == "Kootenai" | county == "Okananogan" | county == "Douglas" | county == "Grant" | county == "Benton" | county == "Franklin" | county == "Walla Walla" | county == "Adams" | county == "Lincoln" | county == "Spokane" | county == "Whitman" | county == "Columbia" | county == "Garfield" | county == "Asotin" | county == "Wasco" | county == "Sherman" | county == "Gilliam" | county == "Morrow" | county == "Umatilla" | county == "Union" | county == "Wallowa")
claimaggcountpalouse <- subset(claimaggcount, county == "Idaho" | county == "Lewis" | county == "Nez Perce" | county == "Clearwater" | county == "Latah" | county == "Benewah" | county == "Kootenai" | county == "Okananogan" | county == "Douglas" | county == "Grant" | county == "Benton" | county == "Franklin" | county == "Walla Walla" | county == "Adams" | county == "Lincoln" | county == "Spokane" | county == "Whitman" | county == "Columbia" | county == "Garfield" | county == "Asotin" | county == "Wasco" | county == "Sherman" | county == "Gilliam" | county == "Morrow" | county == "Umatilla" | county == "Union" | county == "Wallowa")
claimaggacrespalouse <- subset(claimaggacres, county == "Idaho" | county == "Lewis" | county == "Nez Perce" | county == "Clearwater" | county == "Latah" | county == "Benewah" | county == "Kootenai" | county == "Okananogan" | county == "Douglas" | county == "Grant" | county == "Benton" | county == "Franklin" | county == "Walla Walla" | county == "Adams" | county == "Lincoln" | county == "Spokane" | county == "Whitman" | county == "Columbia" | county == "Garfield" | county == "Asotin" | county == "Wasco" | county == "Sherman" | county == "Gilliam" | county == "Morrow" | county == "Umatilla" | county == "Union" | county == "Wallowa")


colnames(claimaggcountpalouse)[7] <- "count"
colnames(claimaggmeanpalouse)[7] <- "meanloss"

setwd("/dmine/data/USDA/agmesh-scenarios/Allstates/summaries/")
write.csv(claimaggcountpalouse, file = "Palouse_summary_counts.csv")
write.csv(claimaggmeanpalouse, file = "Palouse_summary_meanloss.csv")
write.csv(claimaggpalouse, file = "Palouse_summary_sumloss.csv")
write.csv(claimaggacrespalouse, file = "Palouse_summary_sumacres.csv")

write.csv(claimaggcount, file = "PNW_summary_counts.csv")
write.csv(claimaggmean, file = "PNW_summary_meanloss.csv")
write.csv(claimagg, file = "PNW_summary_sumloss.csv")
write.csv(claimaggacres, file = "PNW_summary_sumacres.csv")

##--merge into two files - one for all of the PNW and one for the Palouse


claimaggallpalouse <- cbind(claimaggpalouse, claimaggcountpalouse$count, claimaggmeanpalouse$meanloss, claimaggacrespalouse$acres) 
claimaggallpalouse$lossperacre <- (claimaggallpalouse$loss / claimaggallpalouse[10])

claimaggall <- cbind(claimagg, claimaggcount$count, claimaggmean$meanloss, claimaggacres$acres) 
claimaggall$lossperacre <- (claimaggall$loss / claimaggall[10])
claimaggall$lossperacre <- round(claimaggall$lossperacre, 4)

colnames(claimaggallpalouse)[8] <- "count"
colnames(claimaggallpalouse)[9] <- "meanloss"
colnames(claimaggallpalouse)[10] <- "acres"
colnames(claimaggallpalouse)[11] <- "lossperacre"


colnames(claimaggall)[8] <- "count"
colnames(claimaggall)[9] <- "meanloss"
colnames(claimaggall)[10] <- "acres"
colnames(claimaggall)[11] <- "lossperacres"



#------------



library(RCurl)
library(jsonlite) 

file_ID <- fromJSON("http://quickstats.nass.usda.gov/api/api_GET/?key=F9BAFEBF-FCA8-384A-8204-5DB45FBCDBDD&commodity_desc=WHEAT&year__GE=1994&state_alpha=ID&format=JSON")

file_WA <- fromJSON("http://quickstats.nass.usda.gov/api/api_GET/?key=F9BAFEBF-FCA8-384A-8204-5DB45FBCDBDD&commodity_desc=WHEAT&year__GE=1989&state_alpha=WA&format=JSON")

file_OR <- fromJSON("http://quickstats.nass.usda.gov/api/api_GET/?key=F9BAFEBF-FCA8-384A-8204-5DB45FBCDBDD&commodity_desc=WHEAT&year__GE=1990&state_alpha=OR&format=JSON")

cashrent <- fromJSON("http://quickstats.nass.usda.gov/api/api_GET/?key=F9BAFEBF-FCA8-384A-8204-5DB45FBCDBDD&sector_desc=ECONOMICS&commodity_desc=RENT&year__GE=1990&state_alpha=OR&format=JSON")



setwd("/dmine/data/NASS/")

file_frame_WA <- as.data.frame(file_WA)
file_frame_ID <- as.data.frame(file_ID)
file_frame_OR <- as.data.frame(file_OR)
cr <- as.data.frame(cashrent)

#xx <- subset(file_frame_OR, data.year == 2000)
#xxx <- subset(xx, data.county_name == "GRANT")

write.table(file_WA, file = "/dmine/data/NASS/NASS_WA_1989_2015")
write.table(file_ID, file = "/dmine/data/NASS/NASS_ID_1989_2015")
write.table(file_OR, file = "/dmine/data/NASS/NASS_OR_1989_2015")
write.table(cr, file = "/dmine/data/NASS/NASS_cashrent_2015")

#-------------------

fileWA <- read.table("/dmine/data/NASS/NASS_Washington_1989_2015")
fileOR <- read.table("/dmine/data/NASS/NASS_Oregon_1989_2015")
fileID <- read.table("/dmine/data/NASS/NASS_Idaho_1989_2015")
cash_rent <- read.table("/dmine/data/NASS/NASS_cashrent_2015")

file_frameWA <- as.data.frame(fileWA)
file_nameWA <- subset(file_frameWA, file_frameWA$data.Value != "NA")
file_nameWA <- subset(file_nameWA, file_frameWA$data.county_name != "")
file_nameWA <- subset(file_nameWA, file_frameWA$data.county_name != "OTHER (COMBINED) COUNTIES")
file_nameWA <- subset(file_nameWA, file_nameWA$data.source_desc == "SURVEY")
file_nameWA <- subset(file_nameWA, file_nameWA$data.statisticcat_desc == "AREA HARVESTED")
#file_name2 <- subset(file_name2, file_name2$data.commodity_desc == "WHEAT")
#file_nameWA <- subset(file_nameWA, file_nameWA$data.county_name == "WHITMAN")

file_nameWA$data.Value <- as.numeric(file_nameWA$data.Value)
file_nameWAagg <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_nameWA, mean)
colnames(file_nameWAagg) <- c("year", "commodity", "county", "state", "meanharvested")


file_frameID <- as.data.frame(fileID)
file_nameID <- subset(file_frameID, file_frameID$data.Value != "NA")
file_nameID <- subset(file_nameID, file_frameID$data.county_name != "")
file_nameID <- subset(file_nameID, file_frameID$data.county_name != "OTHER (COMBINED) COUNTIES")
file_nameID <- subset(file_nameID, file_nameID$data.source_desc == "SURVEY")
file_nameID <- subset(file_nameID, file_nameID$data.statisticcat_desc == "AREA HARVESTED")

file_nameID$data.Value <- as.numeric(file_nameID$data.Value)
file_nameIDagg <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_nameID, mean)
colnames(file_nameIDagg) <- c("year", "commodity", "county", "state", "meanharvested")


file_frameOR <- as.data.frame(fileOR)
file_nameOR <- subset(file_frameOR, file_frameOR$data.Value != "NA")
file_nameOR <- subset(file_nameOR, file_frameOR$data.county_name != "")
file_nameOR <- subset(file_nameOR, file_frameOR$data.county_name != "OTHER (COMBINED) COUNTIES")
file_nameOR <- subset(file_nameOR, file_nameOR$data.source_desc == "SURVEY")
file_nameOR <- subset(file_nameOR, file_nameOR$data.statisticcat_desc == "AREA HARVESTED")

file_nameOR$data.Value <- as.numeric(file_nameOR$data.Value)

file_nameORaggmean <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_nameOR, mean)
colnames(file_nameORaggmean) <- c("year", "commodity", "county", "state", "meanharvested")

file_nameORaggcount <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_nameOR, length)
colnames(file_nameORaggcount) <- c("year", "commodity", "county", "state", "harvestedcount")

file_nameORaggsum <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_nameOR, sum)
colnames(file_nameORaggsum) <- c("year", "commodity", "county", "state", "totalharvested")

file_name5 <- cbind(file_nameORaggmean, file_nameORaggcount$harvestedcount, file_nameORaggsum$totalharvested)
colnames(file_name5) <- c("year", "commodity", "county", "state", "meanharvested", "harvestedcount", "totalharvested")









#--cash rent all states, OR, ID, and WA

file_cr <- as.data.frame(cash_rent)
file_cr <- subset(file_cr, file_cr$data.Value != "NA")
file_cr <- subset(file_cr, file_cr$data.county_name != "")
file_cr <- subset(file_cr, file_cr$data.county_name != "OTHER (COMBINED) COUNTIES")
file_cr <- subset(file_cr, file_cr$data.source_desc == "SURVEY")
#file_cr <- subset(file_cr, file_cr$data.statisticcat_desc == "AREA HARVESTED")

file_cr$data.Value <- as.numeric(file_cr$data.Value)
file_cragg <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_cr, length)

#-------

file_name2 <- rbind(file_nameOR, file_nameID, file_nameWA)
file_name2$data.Value <- as.numeric(file_name2$data.Value)

file_name3 <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_name2, sum)
file_name4 <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_name2, length)
file_name5 <-  aggregate(data.Value ~ data.year + data.commodity_desc + data.county_name + data.state_name, file_name2, mean)

file_name5 <- cbind(file_name3, file_name4$data.Value, file_name5$data.Value)
colnames(file_name5) <- c("year", "commodity", "county", "state", "totalharvested", "harvestedcount", "meanharvested")



#file_name2$data.Value <- (gsub(",","", file_name2[,'data.Value']))

#file_name5 <- subset(file_name5, totalharvested > 0)
#file_name5 <- as.data.frame(file_name5)

newzz<- subset(file_nameIDagg, county == "LATAH")
#x <- as.numeric(newzz$data.Value)
#x <- as.numeric(file_nameORagg$data.Value)
y <- newzz$year
yy <- as.vector(min(y):2015)
yya <- as.data.frame(yy)
colnames(yya) <- "year"

colnames(newzz)[1] <- c("year")

newzz2 <- join(yya, newzz, by = "year")
xxx <- as.numeric(newzz2$meanharvested)
boxplot(xxx~factor(yy), xlab="Year", ylab="data value", main="Oregon", las=3)

